{"version":3,"file":"commonHelpers.js","sources":["../src/js/catalog.js"],"sourcesContent":["import TmdbApi from './tmdb-api';\nimport openMovieInfoModal from './modal-window';\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n  const tmdb = new TmdbApi();\n  const catalogCardsContainer = document.querySelector('.catalog-movie-list');\n  const sorryMessage = document.querySelector('.catalog-sorry-message');\n  const input = document.querySelector('.input-text');\n  const searchButton = document.querySelector('.catalog-button');\n  const yearSelect = document.querySelector('.year-select');\n  const xButton = document.querySelector('.x-button');\n  const pagination = document.querySelector('.pagination-container'); // Container for pagination buttons\n\n  const genreAbbreviations = { 'Science Fiction': 'Sci-Fi' };\n  let currentPage = 1;\n  let totalPages = 1;\n  let query = '';\n\n  sorryMessage.style.display = 'none';\n\n  const fetchMovies = async (page = 1) => {\n    try {\n      const movies = query ? await tmdb.searchMovieTotal(query, page) : await tmdb.getTrendingMoviesTotal('week', page);\n      totalPages = Math.ceil(movies.total_results / 18); // Calculate total pages\n      return movies.results.slice(0, 18);\n    } catch (e) {\n      console.error('Error fetching movies:', e);\n      return [];\n    }\n  };\n\n  const fetchGenres = async () => {\n    try { return await tmdb.getMovieGenres(); }\n    catch (e) { console.error('Error fetching genres:', e); return []; }\n  };\n\n  const getGenres = await fetchGenres();\n  const filterByYear = (movies, year) => year ? movies.filter(m => new Date(m.release_date).getFullYear() == year) : movies;\n\n  const starRating = rating => {\n    const fullStars = Math.floor(rating / 2);\n    const halfStar = rating % 2 >= 1 ? 1 : 0;\n    return '<svg class=\"star full\"><use xlink:href=\"#icon-star\"></use></svg>'.repeat(fullStars) +\n           (halfStar ? '<svg class=\"star half\"><use xlink:href=\"#icon-star-half\"></use></svg>' : '') +\n           '<svg class=\"star empty\"><use xlink:href=\"#icon-star-outline\"></use></svg>'.repeat(5 - Math.ceil(rating / 2));\n  };\n\n  const renderMovies = async (page = 1) => {\n    const movies = filterByYear(await fetchMovies(page), yearSelect.value);\n    catalogCardsContainer.innerHTML = '';\n    sorryMessage.style.display = movies.length ? 'none' : 'block';\n\n    movies.forEach(m => {\n      const genres = m.genre_ids.slice(0, 2).map(id => (getGenres.find(g => g.id === id)?.name || 'Unknown')).map(name => genreAbbreviations[name] || name).join(', ');\n      const releaseDate = m.release_date ? new Date(m.release_date).getFullYear() : 'Unknown';\n      const rating = Math.round(m.vote_average * 10) / 10;\n\n      const card = document.createElement('li');\n      card.classList.add('card');\n      card.style.background = `url(https://image.tmdb.org/t/p/w500${m.poster_path}) center/cover`;\n      card.dataset.id = m.id;\n      card.innerHTML = `\n        <div class=\"card-content\">\n          <h2>${m.title}</h2>\n          <p>${genres} | ${releaseDate} <span class=\"stars\">${starRating(rating)}</span></p>\n        </div>\n      `;\n      card.addEventListener('click', () => openMovieInfoModal(m.id));\n      catalogCardsContainer.appendChild(card);\n    });\n\n    renderPagination(page);\n  };\n\n  const renderPagination = (currentPage) => {\n    pagination.innerHTML = '';\n\n    if (totalPages <= 1) return;\n\n    const createPageButton = page => {\n      const button = document.createElement('button');\n      button.textContent = page;\n      button.classList.add('page-number-button');\n      if (page === currentPage) {\n        button.classList.add('active');\n      }\n      button.addEventListener('click', () => {\n        currentPage = page;\n        renderMovies(currentPage);\n      });\n      return button;\n    };\n\n    if (totalPages > 1) {\n      const prevButton = document.createElement('button');\n      prevButton.textContent = '←';\n      prevButton.classList.add('arrow-button');\n      prevButton.disabled = currentPage === 1;\n      prevButton.addEventListener('click', () => {\n        if (currentPage > 1) {\n          currentPage--;\n          renderMovies(currentPage);\n        }\n      });\n      pagination.appendChild(prevButton);\n    }\n\n    const startPage = Math.max(1, currentPage - 2);\n    const endPage = Math.min(totalPages, currentPage + 2);\n\n    for (let page = startPage; page <= endPage; page++) {\n      pagination.appendChild(createPageButton(page));\n    }\n\n    if (endPage < totalPages) {\n      const dots = document.createElement('span');\n      dots.textContent = '...';\n      pagination.appendChild(dots);\n      pagination.appendChild(createPageButton(totalPages));\n    }\n\n    if (totalPages > 1) {\n      const nextButton = document.createElement('button');\n      nextButton.textContent = '→';\n      nextButton.classList.add('arrow-button');\n      nextButton.disabled = currentPage === totalPages;\n      nextButton.addEventListener('click', () => {\n        if (currentPage < totalPages) {\n          currentPage++;\n          renderMovies(currentPage);\n        }\n      });\n      pagination.appendChild(nextButton);\n    }\n  };\n\n  const handleSearch = () => {\n    query = input.value.trim();\n    currentPage = 1;\n    renderMovies(currentPage);\n  };\n\n  searchButton.addEventListener('click', handleSearch);\n  yearSelect.addEventListener('change', handleSearch);\n  xButton.addEventListener('click', () => {\n    input.value = '';\n    handleSearch();\n  });\n  input.addEventListener('input', () => xButton.style.visibility = input.value.trim() ? 'visible' : 'hidden');\n\n  // Initial load\n  renderMovies(currentPage);\n});\n"],"names":["tmdb","TmdbApi","catalogCardsContainer","sorryMessage","input","searchButton","yearSelect","xButton","pagination","genreAbbreviations","currentPage","totalPages","query","fetchMovies","page","movies","e","getGenres","filterByYear","year","m","starRating","rating","fullStars","halfStar","renderMovies","genres","id","_a","g","name","releaseDate","card","openMovieInfoModal","renderPagination","createPageButton","button","prevButton","startPage","endPage","dots","nextButton","handleSearch"],"mappings":"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"}